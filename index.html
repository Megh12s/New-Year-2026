<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy New Year 2026</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="app">
        <div class="happy">Happy New Year</div>
        <div class="sec1">
            <span>202</span>
            <span class="current">5</span>
            <span class="next">6</span>
            <div class="sec2"></div>

        </div>

        <div class="fire">
            <div class="f1">
                <span><i></i></span>
                <span><i></i></span>
                <span><i></i></span>
            </div>
            <div class="f2">
                <span><i></i></span>
                <span><i></i></span>
                <span><i></i></span>
            </div>
            <div class="f3">
                <span><i></i></span>
                <span><i></i></span>
                <span><i></i></span>
            </div>
            <div class="f4">
                <span><i></i></span>
                <span><i></i></span>
                <span><i></i></span>
            </div>
        </div>
    </div>

    <script>
        // Robust audio unlocking + play on fire animation start
        const sound = document.getElementById('firework-sound');

        // Attempt continuous autoplay (loop) and fallback to buffer-based playback of `fire.mp3` if autoplay is blocked
        let audioCtx = null;
        let bufferSource = null;
        let bufferPlaying = false;

        async function startBufferFallback() {
            if (bufferPlaying) return;
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                // Fetch and decode the audio file, then play it as a looping buffer source
                const resp = await fetch('fire.mp3');
                if (!resp.ok) throw new Error('Failed to fetch fire.mp3');
                const arrayBuffer = await resp.arrayBuffer();
                const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer.slice(0));

                bufferSource = audioCtx.createBufferSource();
                bufferSource.buffer = audioBuffer;
                bufferSource.loop = true;
                bufferSource.connect(audioCtx.destination);
                bufferSource.start(0);
                bufferPlaying = true;
            } catch (e) {
                console.warn('Buffer fallback failed:', e);
            }
        }

        if (sound) {
            sound.loop = true;
            sound.currentTime = 0;
            sound.play().catch(() => {
                // Autoplay may be blocked; start buffer fallback so audio still plays
                startBufferFallback();
            });

            // If the audio element raises an error (file missing/bad), start the buffer fallback
            sound.addEventListener('error', () => startBufferFallback());
        }

        // Click creates a firework and also attempts to start audio if blocked
        document.addEventListener('click', function (event) {
            if (sound) sound.play().catch(() => startBufferFallback());
            else startBufferFallback();
            // compute coordinates relative to #app container
            const container = document.getElementById('app') || document.body;
            const rect = container.getBoundingClientRect();
            const x = event.clientX;
            const y = event.clientY;
            createFirework(x, y);
        });

        function createFirework(x, y) {
            const fw = document.createElement('div');
            fw.className = 'firework';
            fw.style.left = x + 'px';
            fw.style.top = y + 'px';

            const colors = ['#ff5f6d', '#ffc371', '#7bf1a8', '#7a8fe8', '#f48fd1', '#ffd166'];

            // adapt particle count and speed to device size for performance
            const w = window.innerWidth;
            let minCount = 48, maxCount = 88, minSpeed = 80, maxSpeed = 300;
            if (w <= 600) { // mobile
                minCount = 18; maxCount = 36; minSpeed = 50; maxSpeed = 180;
            } else if (w <= 1024) { // tablet
                minCount = 32; maxCount = 56; minSpeed = 60; maxSpeed = 220;
            }

            const count = minCount + Math.floor(Math.random() * (maxCount - minCount + 1));
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const angle = Math.random() * Math.PI * 2;
                const speed = minSpeed + Math.random() * (maxSpeed - minSpeed);
                const dx = Math.cos(angle) * speed + 'px';
                const dy = Math.sin(angle) * speed + 'px';
                p.style.setProperty('--dx', dx);
                p.style.setProperty('--dy', dy);
                const size = (w <= 600) ? (4 + Math.random() * 8) : (6 + Math.random() * 14);
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.background = colors[Math.floor(Math.random() * colors.length)];
                p.style.animationDuration = (800 + Math.random() * 800) + 'ms';
                fw.appendChild(p);
            }

            const sp = document.createElement('div');
            sp.className = 'sparkle';
            fw.appendChild(sp);

            const container = document.getElementById('app') || document.body;
            // position already set relative to container in calling code
            container.appendChild(fw);
            setTimeout(() => fw.remove(), 2200);
        }

        // support touchstart for mobile (use first touch point)
        document.addEventListener('touchstart', function (e) {
            if (!e.touches || e.touches.length === 0) return;
            const t = e.touches[0];
            const container = document.getElementById('app') || document.body;
            const rect = container.getBoundingClientRect();
            createFirework(t.clientX, t.clientY);
        }, { passive: true });

        // Auto-launch sporadic fireworks; adjust frequency by device
        (function autoLaunch() {
            function schedule() {
                const w = window.innerWidth;
                let delayMin = 900, delayMax = 2400;
                if (w <= 600) { delayMin = 1400; delayMax = 4200; }
                else if (w <= 1024) { delayMin = 1100; delayMax = 3000; }
                const delay = delayMin + Math.random() * (delayMax - delayMin);
                setTimeout(() => {
                    const container = document.getElementById('app') || document.body;
                    const rect = container.getBoundingClientRect();
                    const x = rect.left + rect.width * (0.1 + Math.random() * 0.8);
                    const y = rect.top + rect.height * (0.15 + Math.random() * 0.6);
                    createFirework(x, y);
                    schedule();
                }, delay);
            }
            schedule();
        })();

        // Create a full-screen overlay that forces a user gesture to start audio reliably
        (function createEnableOverlay() {
            const overlay = document.createElement('div');
            overlay.id = 'enable-sound-overlay';
            Object.assign(overlay.style, {
                position: 'fixed',
                inset: '0',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                background: 'rgba(0,0,0,0.6)',
                color: '#fff',
                zIndex: 99999,
            });

            const box = document.createElement('div');
            Object.assign(box.style, {
                textAlign: 'center',
                padding: '24px',
                background: 'rgba(255,255,255,0.06)',
                borderRadius: '12px'
            });

            const title = document.createElement('div');
            title.textContent = 'Click to enable sound';
            Object.assign(title.style, { fontSize: '20px', marginBottom: '12px' });

            const btn = document.createElement('button');
            btn.textContent = 'Enable Sound';
            Object.assign(btn.style, {
                padding: '10px 18px',
                fontSize: '16px',
                borderRadius: '8px',
                border: 'none',
                cursor: 'pointer'
            });

            btn.addEventListener('click', async () => {
                try {
                    if (sound) await sound.play();
                    else if (typeof startBufferFallback === 'function') await startBufferFallback();
                    if (typeof audioCtx !== 'undefined' && audioCtx && audioCtx.state === 'suspended') await audioCtx.resume();
                } catch (e) {
                    // ignore
                }
                overlay.remove();
            });

            box.appendChild(title);
            box.appendChild(btn);
            overlay.appendChild(box);
            document.body.appendChild(overlay);
        })();

    </script>
    <audio id="firework-sound" preload="auto" autoplay loop>
        <source src="fire.mp3" type="audio/mpeg">
    </audio>

</body>

</html>
